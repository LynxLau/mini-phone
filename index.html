<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
  <title>Mini Phone Â· Chat + Music</title>
  <!-- Tailwind (CDN JIT) -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- React 18 + Babel (æ— æ‰“åŒ…è¿è¡Œ) -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script crossorigin src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    :root { --accent:#7c5cff; }
    html,body{height:100%; background:#0a0a0a;}
    body{margin:0; display:grid; place-items:center; overflow:hidden;}
    /* è®©æ‰‹æœºå¤–å±‚è‡ªé€‚åº”çª—å£ï¼Œæ‰‹æœºå†…éƒ¨è‡ªå·±æ»šåŠ¨ */
    .phone-wrap{height:100dvh; aspect-ratio:9/19.5; max-height:900px; max-width:min(480px, 100vw); padding:16px;}
    .glass { background: rgba(255,255,255,0.06); }
    .panel { background: rgba(0,0,0,0.5); border:1px solid rgba(255,255,255,0.08); }
    .toast{position:fixed; left:50%; transform:translateX(-50%); bottom:20px; padding:8px 12px; border-radius:10px; background:#d33; color:#fff; font-size:12px;}
  </style>
</head>
<body>
  <div id="app"></div>

  <script type="text/babel">
    const {useState,useEffect,useMemo,useRef} = React;

    /* ------------- å·¥å…· ------------- */
    const uid = () => Math.random().toString(36).slice(2,9);
    const loadJSON=(k,f)=>{try{const r=localStorage.getItem(k);return r?JSON.parse(r):f}catch{return f}};
    const saveJSON=(k,v)=>{try{localStorage.setItem(k,JSON.stringify(v))}catch{}};
    function fileToDataURL(file){return new Promise((res,rej)=>{if(!file) return res(""); const r=new FileReader(); r.onload=()=>res(r.result); r.onerror=rej; r.readAsDataURL(file);});}
    function showError(msg){ const el=document.createElement('div'); el.className='toast'; el.textContent='æ‰¾ä¸åˆ°æ–‡ä»¶'===msg?msg:('é”™è¯¯ï¼š'+msg); document.body.appendChild(el); setTimeout(()=>el.remove(),2400); }

    /* ------------- App ------------- */
    function App(){
      // ä¸»é¢˜
      const [theme,setTheme]=useState(()=>loadJSON('mp_theme',{
        accent:'#7c5cff', bgType:'image', bgColor:'#0b0b0f', bgImage:'', blur:8, glass:true,
        font:'Inter, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto'
      }));
      // è®¾ç½®
      const [settings,setSettings]=useState(()=>loadJSON('mp_settings',{
        apiBase:'https://api.openai.com/v1', apiKey:'', model:'', systemPrompt:'',
        characterName:'Valuri', avatar:'', temperature:0.6
      }));
      // æ’­æ”¾åˆ—è¡¨
      const [playlist,setPlaylist]=useState(()=>loadJSON('mp_playlist',[
        {id:uid(), title:'Sleepy Cat', url:''}
      ]));
      const [currentId,setCurrentId]=useState(()=>loadJSON('mp_current', null));

      // æŒä¹…åŒ–
      useEffect(()=>saveJSON('mp_theme',theme),[theme]);
      useEffect(()=>saveJSON('mp_settings',settings),[settings]);
      useEffect(()=>saveJSON('mp_playlist',playlist),[playlist]);
      useEffect(()=>saveJSON('mp_current',currentId),[currentId]);

      // æ³¨å…¥ CSS å˜é‡
      useEffect(()=>{
        const r=document.documentElement.style;
        r.setProperty('--accent', theme.accent);
      },[theme.accent]);

      // èƒŒæ™¯æ ·å¼
      const bgStyle = useMemo(()=>{
        if(theme.bgType==='color') return {background:theme.bgColor};
        return {backgroundImage:`url(${theme.bgImage})`, backgroundSize:'cover', backgroundPosition:'center'};
      },[theme]);

      return (
        <div className="phone-wrap w-full">
          <div className="relative w-full h-full rounded-[32px] border border-white/15 shadow-2xl overflow-hidden bg-black/80" style={bgStyle}>
            {/* æ¨¡ç³Šå±‚ */}
            <div className="absolute inset-0" style={{backdropFilter:`blur(${theme.blur}px)`}}/>
            {/* æ‰‹æœºå¬ç­’è£…é¥° */}
            <div className="absolute left-1/2 -translate-x-1/2 top-2 w-40 h-4 rounded-full bg-black/60 border border-white/10" />
            {/* å†…å®¹åŒº */}
            <PhoneContent
              theme={theme} setTheme={setTheme}
              settings={settings} setSettings={setSettings}
              playlist={playlist} setPlaylist={setPlaylist}
              currentId={currentId} setCurrentId={setCurrentId}
            />
          </div>
        </div>
      );
    }

    /* ------------- PhoneContent ------------- */
    function PhoneContent(props){
      const {theme,setTheme,settings,setSettings,playlist,setPlaylist,currentId,setCurrentId} = props;
      const [screen,setScreen]=useState('home'); // home | music | chat | settings | diary | weibo
      return (
        <div className="absolute inset-0 flex flex-col" style={{fontFamily:theme.font}}>
          {/* é¡¶æ  */}
          <div className="p-3 flex items-center justify-between">
            <div className="text-xs text-white/70">{new Date().toTimeString().slice(0,5)}</div>
            <div className="text-xs text-white/70 px-2 py-1 rounded-full border border-white/10 bg-black/40">API {props.settings.apiKey ? 'ON':'OFF'}</div>
          </div>

          {/* å±å¹•å¯æ»šåŠ¨ */}
          <div className="flex-1 overflow-auto px-4 pb-4 space-y-3">
            {screen==='home' && (
              <HomeGrid
                theme={theme}
                playlist={playlist} setPlaylist={setPlaylist}
                currentId={currentId} setCurrentId={setCurrentId}
                goto={setScreen}
              />
            )}

            {screen==='music' && <MusicPage playlist={playlist} setPlaylist={setPlaylist} currentId={currentId} setCurrentId={setCurrentId} back={()=>setScreen('home')}/>}

            {screen==='chat' && <ChatPage settings={settings} back={()=>setScreen('home')}/>}

            {screen==='diary' && <DiaryPage back={()=>setScreen('home')}/>}

            {screen==='weibo' && <WeiboPage back={()=>setScreen('home')}/>}

            {screen==='settings' && <SettingsPage theme={theme} setTheme={setTheme} settings={settings} setSettings={setSettings} back={()=>setScreen('home')}/>}
          </div>

          {/* åº•éƒ¨ Dock */}
          <div className="px-4 pb-5">
            <div className="panel rounded-2xl p-3 grid grid-cols-3 gap-2">
              <DockBtn label="éŸ³ä¹" onClick={()=>setScreen('music')}>ğŸµ</DockBtn>
              <DockBtn label="èŠå¤©" onClick={()=>setScreen('chat')}>ğŸ’¬</DockBtn>
              <DockBtn label="è®¾ç½®" onClick={()=>setScreen('settings')}>âš™ï¸</DockBtn>
            </div>
          </div>
        </div>
      );
    }

    const DockBtn=({children,label,onClick})=>(
      <button onClick={onClick} className="flex flex-col items-center gap-1 text-white/90">
        <div className="w-12 h-12 rounded-2xl panel grid place-items-center text-xl">{children}</div>
        <div className="text-xs opacity-80">{label}</div>
      </button>
    );

    /* ------------- é¦–é¡µ ------------- */
    function HomeGrid({theme, playlist,setPlaylist,currentId,setCurrentId, goto}){
      const current = useMemo(()=> playlist.find(x=>x.id===currentId) || playlist[0], [playlist,currentId]);
      useEffect(()=>{ if(!current && playlist.length) setCurrentId(playlist[0].id); },[current,playlist,setCurrentId]);
      return (
        <div className="space-y-3">
          {/* å¤§æ’­æ”¾å™¨å¡ç‰‡ */}
          <div className="panel rounded-2xl p-4">
            <div className="flex items-start gap-3">
              <div className="w-16 h-16 rounded-2xl bg-black/50 border border-white/10 grid place-items-center">
                <div className="w-12 h-12 rounded-full bg-gradient-to-br from-black/40 to-black/80 grid place-items-center">
                  <div className="w-2 h-2 bg-white/80 rounded-full"></div>
                </div>
              </div>
              <div className="flex-1 text-white/90">
                <div className="text-base font-medium">Sleepy Cat</div>
                <div className="text-xs opacity-70">anemoia / crossing you</div>
                <div className="mt-2 flex gap-2">
                  <button onClick={()=>goto('music')} className="px-3 py-1.5 rounded bg-[var(--accent)] text-white text-xs">æ‰“å¼€æ’­æ”¾å™¨</button>
                  <button className="px-3 py-1.5 rounded bg-white/10 border border-white/10 text-xs">å½“å‰</button>
                </div>
              </div>
              <div className="text-xs opacity-70">API { /* å ä½ */ }</div>
            </div>
          </div>

          {/* ä¸¤ä¸ªå°ç»„ä»¶å ä½ */}
          <div className="grid grid-cols-2 gap-3">
            <div className="panel rounded-2xl h-28" />
            <div className="panel rounded-2xl h-28" />
          </div>

          {/* å…­å®«æ ¼ */}
          <div className="grid grid-cols-3 gap-6 pt-2">
            <IconBtn label="éŸ³ä¹" onClick={()=>goto('music')}>ğŸµ</IconBtn>
            <IconBtn label="èŠå¤©" onClick={()=>goto('chat')}>ğŸ’¬</IconBtn>
            <IconBtn label="è®¾ç½®" onClick={()=>goto('settings')}>âš™ï¸</IconBtn>
            <IconBtn label="ç›¸å†Œ" onClick={()=>showError('æš‚æœªå¼€æ”¾')}>ğŸ–¼ï¸</IconBtn>
            <IconBtn label="æ—¥è®°" onClick={()=>goto('diary')}>ğŸ“</IconBtn>
            <IconBtn label="å¾®åš" onClick={()=>goto('weibo')}>ğŸ”—</IconBtn>
          </div>
        </div>
      );
    }
    const IconBtn=({children,label,onClick})=>(
      <button onClick={onClick} className="flex flex-col items-center gap-2 text-white/90">
        <div className="w-16 h-16 rounded-2xl panel grid place-items-center text-2xl">{children}</div>
        <div className="text-xs opacity-80">{label}</div>
      </button>
    );

    /* ------------- éŸ³ä¹é¡µ ------------- */
    function MusicPage({playlist,setPlaylist,currentId,setCurrentId,back}){
      const current = useMemo(()=> playlist.find(x=>x.id===currentId) || playlist[0], [playlist,currentId]);
      const [title,setTitle]=useState(''); const [url,setUrl]=useState('');
      const audioRef=useRef(null);
      useEffect(()=>{ if(!current && playlist.length) setCurrentId(playlist[0].id); },[current,playlist,setCurrentId]);
      return (
        <div className="space-y-3">
          <Header title="éŸ³ä¹" back={back}/>
          <div className="panel rounded-2xl p-4 space-y-3">
            <div className="text-sm text-white/90">å½“å‰ï¼š{current? (current.title || 'æœªå‘½åæ›²ç›®'):'æš‚æ— '}</div>
            <audio ref={audioRef} controls src={current?.url || undefined} className="w-full"/>
            <div className="flex gap-2">
              <input className="flex-1 bg-white/10 border border-white/10 rounded px-2 py-1 text-sm" placeholder="æ›²å" value={title} onChange={e=>setTitle(e.target.value)}/>
              <input className="flex-[2] bg-white/10 border border-white/10 rounded px-2 py-1 text-sm" placeholder="éŸ³é¢‘ URL" value={url} onChange={e=>setUrl(e.target.value)}/>
              <button className="px-3 py-1 rounded bg-[var(--accent)] text-white text-sm"
                onClick={()=>{
                  if(!url) return;
                  const t={id:uid(), title:title || (url.split('/').pop()??'æœªå‘½åæ›²ç›®'), url};
                  setPlaylist([...playlist,t]); setTitle(''); setUrl(''); if(!currentId) setCurrentId(t.id);
                }}>æ·»åŠ </button>
            </div>
            <div className="max-h-44 overflow-auto space-y-2">
              {playlist.map(t=>(
                <div key={t.id} className={`flex items-center gap-2 text-sm bg-white/5 border border-white/10 rounded p-2 ${currentId===t.id?'ring-1 ring-[var(--accent)]/70':''}`}>
                  <button onClick={()=>setCurrentId(t.id)} className="text-xs px-2 py-1 rounded bg-white/10">æ’­æ”¾</button>
                  <div className="flex-1 truncate">{t.title||'æœªå‘½åæ›²ç›®'}</div>
                  <button onClick={()=>setPlaylist(playlist.filter(x=>x.id!==t.id))} className="opacity-70 hover:opacity-100 text-xs">åˆ é™¤</button>
                </div>
              ))}
            </div>
          </div>
        </div>
      );
    }

    /* ------------- èŠå¤©é¡µï¼ˆç®€ç‰ˆå ä½ï¼‰ ------------- */
    function ChatPage({settings,back}){
      return (
        <div className="space-y-3">
          <Header title="èŠå¤©" back={back}/>
          <div className="panel rounded-2xl p-6 text-sm text-white/80 space-y-2">
            <div>æ˜µç§°ï¼š{settings.characterName || 'æœªå‘½å'}</div>
            <div>æ¨¡å‹ï¼š{settings.model || 'æœªé€‰æ‹©'}</div>
            <div className="opacity-70">èŠå¤©ç•Œé¢é«˜çº§é…ç½®æˆ‘ä»¬ä¸‹ä¸€æ­¥å†æ¥è¿›æ¥ï¼ˆä¸–ç•Œä¹¦ã€è„šæœ¬ã€æ°”æ³¡è‰²ç­‰ï¼‰ã€‚</div>
          </div>
        </div>
      );
    }

    /* ------------- æ—¥è®°é¡µ / å¾®åšé¡µï¼ˆå ä½ï¼‰ ------------- */
    const DiaryPage=({back})=>(
      <div className="space-y-3">
        <Header title="æ—¥è®°" back={back}/>
        <div className="panel rounded-2xl p-6 text-sm text-white/80">è¿™é‡Œå†™ç‚¹ä»Šå¤©çš„å°æƒ…ç»ªï¼Œå…ˆå–æ°´ï¼Œå†å†™å­—ã€‚</div>
      </div>
    );
    const WeiboPage=({back})=>(
      <div className="space-y-3">
        <Header title="å¾®åš" back={back}/>
        <div className="panel rounded-2xl p-6 text-sm text-white/80">æ”¾ä½ çš„å¸¸ç”¨é“¾æ¥æˆ–åµŒå…¥ä¹Ÿè¡Œã€‚å…ˆæŠŠéª¨æ¶æ­å¥½ã€‚</div>
      </div>
    );

    /* ------------- è®¾ç½®é¡µ ------------- */
    function SettingsPage({theme,setTheme,settings,setSettings,back}){
      return (
        <div className="space-y-3">
          <Header title="è®¾ç½®" back={back}/>
          <SettingsPanel theme={theme} setTheme={setTheme} settings={settings} setSettings={setSettings}/>
        </div>
      );
    }

    const Header=({title,back})=>(
      <div className="flex items-center justify-between">
        <button onClick={back} className="px-3 py-1.5 text-xs rounded bg-white/10 border border-white/10">è¿”å›</button>
        <div className="px-4 py-1.5 rounded-2xl bg-black/50 border border-white/10 text-white/90">{title}</div>
        <div className="w-[62px]"/>{/* å ä½å¯¹é½ */}
      </div>
    );

    /* ------------- SettingsPanelï¼ˆå«æ¨¡å‹åˆ—è¡¨ä¸æµ‹è¯•ï¼‰ ------------- */
    function SettingsPanel({settings,setSettings,theme,setTheme}){
      const [tab,setTab]=useState('api');
      const defaults={apiBase:'https://api.openai.com/v1',apiKey:'',model:'',systemPrompt:'',characterName:'Valuri',avatar:'',temperature:0.6};
      const [temp,setTemp]=useState(()=>({...defaults,...settings}));
      const [tTheme,setTTheme]=useState(theme);
      const tval = Number.isFinite(+temp.temperature)?+temp.temperature:0.6;

      const [models,setModels]=useState([]);
      const [checking,setChecking]=useState(false);
      const [checkMsg,setCheckMsg]=useState('');

      const baseUrl = useMemo(()=> (temp.apiBase||'').replace(/\/$/,''), [temp.apiBase]);
      const headers = useMemo(()=> ({'Content-Type':'application/json','Authorization':'Bearer '+(temp.apiKey||'')}), [temp.apiKey]);

      function saveAll(){ setSettings({...temp,temperature:tval}); setTheme(tTheme); }

      async function fetchModels(){
        setChecking(true); setCheckMsg(''); setModels([]);
        try{
          const res = await fetch(baseUrl + '/models', {headers});
          if(!res.ok) throw new Error('HTTP '+res.status);
          const data = await res.json();
          const list = (data?.data || data?.models || []).map(x=>x.id || x.name).filter(Boolean).sort();
          setModels(list);
          setCheckMsg(`å·²è¿æ¥ âœ… Â· ${list.length} ä¸ªæ¨¡å‹`);
        }catch(e){
          setCheckMsg('è¿æ¥å¤±è´¥ âŒ Â· ' + (e.message||e));
          showError(e.message||e);
        }finally{ setChecking(false); }
      }

      async function testAPI(){
        setChecking(true); setCheckMsg('');
        try{
          const res = await fetch(baseUrl + '/models', {headers});
          if(!res.ok) throw new Error('HTTP '+res.status);
          await res.json();
          setCheckMsg('æµ‹è¯•é€šè¿‡ âœ… Â· API å¯ç”¨');
        }catch(e){
          setCheckMsg('æµ‹è¯•å¤±è´¥ âŒ Â· ' + (e.message||e));
          showError(e.message||e);
        }finally{ setChecking(false); }
      }

      return (
        <div className="grid grid-cols-1 gap-3 text-sm">
          <div className="flex gap-1">
            <TabButton active={tab==='api'} onClick={()=>setTab('api')}>API</TabButton>
            <TabButton active={tab==='beauty'} onClick={()=>setTab('beauty')}>ç¾åŒ–</TabButton>
            <TabButton active={tab==='font'} onClick={()=>setTab('font')}>å­—ä½“</TabButton>
            <TabButton active={tab==='background'} onClick={()=>setTab('background')}>æ‰‹æœºèƒŒæ™¯</TabButton>
          </div>

          {tab==='api' && (
            <div className="rounded-xl border border-white/10 p-3 bg-white/5 space-y-3">
              <Row label="è§’è‰²å"><input value={temp.characterName} onChange={e=>setTemp({...temp,characterName:e.target.value})} className="flex-1 bg-white/10 rounded px-2 py-1 border border-white/10"/></Row>
              <Row label="å¤´åƒ URL"><input value={temp.avatar} onChange={e=>setTemp({...temp,avatar:e.target.value})} className="flex-1 bg-white/10 rounded px-2 py-1 border border-white/10" placeholder="http(s)://..."/></Row>
              <Row label="API Base"><input value={temp.apiBase} onChange={e=>setTemp({...temp,apiBase:e.target.value})} className="flex-1 bg-white/10 rounded px-2 py-1 border border-white/10" placeholder="https://ä½ çš„ç½‘å…³/v1"/></Row>
              <Row label="API Key"><input type="password" value={temp.apiKey} onChange={e=>setTemp({...temp,apiKey:e.target.value})} className="flex-1 bg-white/10 rounded px-2 py-1 border border-white/10" placeholder="sk-..."/></Row>

              <Row label="Model">
                <input value={temp.model} onChange={e=>setTemp({...temp,model:e.target.value})} className="flex-1 bg-white/10 rounded px-2 py-1 border border-white/10" placeholder="é€‰æ‹©æˆ–æ‰‹å¡«"/>
              </Row>

              <div className="flex items-center gap-2">
                <label className="text-xs opacity-80">Temperature</label>
                <input type="range" min="0" max="2" step="0.1" value={tval} onChange={e=>setTemp({...temp,temperature:+e.target.value})}/>
                <span className="text-xs opacity-70 w-10">{tval.toFixed(1)}</span>
              </div>

              <label className="text-xs opacity-80">System Prompt</label>
              <textarea value={temp.systemPrompt} onChange={e=>setTemp({...temp,systemPrompt:e.target.value})} className="bg-white/10 rounded-lg px-3 py-2 border border-white/10 min-h-[88px]"></textarea>

              <div className="mt-2 p-2 rounded-lg bg-white/5 border border-white/10 space-y-2">
                <div className="flex flex-wrap items-center gap-2">
                  <button onClick={fetchModels} disabled={checking || !temp.apiKey || !temp.apiBase}
                          className="text-xs px-3 py-1 rounded bg-white/10 border border-white/10 hover:bg-white/15 disabled:opacity-50">
                    {checking ? 'è·å–ä¸­â€¦' : 'è·å–æ¨¡å‹åˆ—è¡¨'}
                  </button>
                  <button onClick={testAPI} disabled={checking || !temp.apiKey || !temp.apiBase}
                          className="text-xs px-3 py-1 rounded bg-white/10 border border-white/10 hover:bg-white/15 disabled:opacity-50">
                    {checking ? 'æµ‹è¯•ä¸­â€¦' : 'æµ‹è¯• API'}
                  </button>

                  {models.length>0 && (
                    <>
                      <span className="text-xs opacity-70">é€‰æ‹©æ¨¡å‹ï¼š</span>
                      <select className="text-xs bg-white/10 px-2 py-1 rounded border border-white/10"
                              value={temp.model || models[0]}
                              onChange={e=>setTemp({...temp,model:e.target.value})}>
                        {models.map(m => <option key={m} value={m}>{m}</option>)}
                      </select>
                    </>
                  )}
                </div>
                <div className="text-xs opacity-80">{checkMsg || 'è¯´æ˜ï¼šå¤šæ•° OpenAI å…¼å®¹æ¥å£æ”¯æŒ /v1/modelsã€‚è‹¥è·¯å¾„ä¸åŒï¼ŒæŠŠ API Base æ”¹åˆ°å…¶ /v1 æ ¹å³å¯ã€‚'}</div>
              </div>

              <div className="flex items-center justify-end gap-2 mt-2">
                <button onClick={saveAll} className="text-xs px-3 py-1 rounded bg-[var(--accent)] text-white">ä¿å­˜</button>
              </div>
            </div>
          )}

          {tab==='beauty' && (
            <div className="rounded-xl border border-white/10 p-3 bg-white/5 space-y-3">
              <Row label="ä¸»é¢˜è‰²"><input type="color" value={tTheme.accent} onChange={e=>setTTheme({...tTheme,accent:e.target.value})} className="w-8 h-8 rounded"/></Row>
              <Row label="æ¯›ç»ç’ƒ"><input type="checkbox" checked={tTheme.glass} onChange={e=>setTTheme({...tTheme,glass:e.target.checked})}/></Row>
              <Row label="æ¨¡ç³Š"><input type="range" min="0" max="20" value={tTheme.blur} onChange={e=>setTTheme({...tTheme,blur:+e.target.value})}/> <span className="text-xs opacity-70 w-8 text-right">{tTheme.blur}</span></Row>
            </div>
          )}

          {tab==='font' && (
            <div className="rounded-xl border border-white/10 p-3 bg-white/5 space-y-3">
              <Row label="å­—ä½“æ ˆ"><input value={tTheme.font} onChange={e=>setTTheme({...tTheme,font:e.target.value})} className="flex-1 bg-white/10 rounded px-2 py-1 border border-white/10"/></Row>
              <div className="flex flex-wrap gap-2 text-xs">
                {[
                  'Inter, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto',
                  'Noto Serif SC, ui-serif, Georgia, serif',
                  'LXGW WenKai, system-ui, sans-serif',
                ].map(f=>(<button key={f} onClick={()=>setTTheme({...tTheme,font:f})} className="px-2 py-1 rounded bg-white/10 border border-white/10 hover:bg-white/15">{f.split(',')[0]}</button>))}
              </div>
            </div>
          )}

          {tab==='background' && (
            <div className="rounded-xl border border-white/10 p-3 bg-white/5 space-y-3">
              <Row label="ç±»å‹">
                <select value={tTheme.bgType} onChange={e=>setTTheme({...tTheme,bgType:e.target.value})} className="text-xs bg-white/10 px-2 py-1 rounded border border-white/10">
                  <option value="color">çº¯è‰²èƒŒæ™¯</option>
                  <option value="image">å›¾ç‰‡èƒŒæ™¯</option>
                </select>
              </Row>
              {tTheme.bgType==='color' ? (
                <Row label="é¢œè‰²"><input type="color" value={tTheme.bgColor} onChange={e=>setTTheme({...tTheme,bgColor:e.target.value})} className="w-8 h-8 rounded"/></Row>
              ) : (
                <Row label="å›¾ç‰‡">
                  <label className="text-xs bg-white/10 px-2 py-1 rounded border border-white/10 cursor-pointer">ä¸Šä¼ å›¾ç‰‡
                    <input type="file" accept="image/*" className="hidden" onChange={e=>fileToDataURL(e.target.files&&e.target.files[0]).then(url=>setTTheme({...tTheme,bgImage:url||''}))}/>
                  </label>
                  {tTheme.bgImage && <button onClick={()=>setTTheme({...tTheme,bgImage:''})} className="ml-2 text-xs px-2 py-1 rounded bg-white/10 border border-white/10">æ¸…é™¤</button>}
                </Row>
              )}
              <div className="text-xs opacity-70">æç¤ºï¼šè¿™ä¸ªèƒŒæ™¯åªä½œç”¨äºæ‰‹æœºå±å¹•å†…éƒ¨ã€‚</div>
            </div>
          )}
        </div>
      );
    }

    const Row=({label,children})=>(<div className="flex items-center gap-3"><div className="w-20 shrink-0 text-xs opacity-80">{label}</div><div className="flex-1 flex items-center flex-wrap gap-2">{children}</div></div>);
    const TabButton=({active,onClick,children})=>(<button onClick={onClick} className={`px-3 py-1.5 rounded-lg border text-xs ${active?'bg-white/15 border-white/20':'bg-white/5 border-white/10 hover:bg-white/10'}`}>{children}</button>);

    /* ------------- æ¸²æŸ“ ------------- */
    ReactDOM.createRoot(document.getElementById('app')).render(<App/>);

    /* ------------- è½»é‡å†…ç½®æµ‹è¯• ------------- */
    if (typeof window!=='undefined'){
      try{
        console.assert(typeof uid()==='string' && uid().length>=3,'uid returns short string');
        console.assert(loadJSON('__missing__',42)===42,'loadJSON fallback ok');
        console.log('[MiniPhone] ready');
      }catch(e){ console.error('[MiniPhone tests] failed',e); }
    }
  </script>
</body>
</html>
